<h1 class="page-header">Tournaments</h1>

<p><%= link_to "Create a new tournament", new_tournament_path, class: "btn btn-primary" if is_admin? %></p>

<section class="card bg-light">
  <section class="card-header">
    Filters
  </section>
  <section class="card-body">
    <%= form_with url: tournaments_path, method: :get, local: true do |f| %>
      <%= hidden_field_tag 'sort', params[:sort] if params[:sort] %>
      <%= hidden_field_tag 'direction', params[:direction] if params[:direction] %>
      <section class="row">
        <section class="col-md">
          <span>Locations</span>
          <% @filter_options[:locations].each do |location| %>
            <section class="form-check">
              <label class="form-check-label">
                <%= f.check_box "location_filters[]", { class: "form-check-input", checked: !@filters_to_apply || params[:location_filters].try(:include?, location) }, location, nil %>
                <%= location %>
              </label>
            </section>
          <% end %>
        </section>
        <section class="col-md">
          <section class="form-group">
            <%= f.label :earliest_start_date %>
            <%= f.date_field :earliest_start_date, value: params[:earliest_start_date], class: "form-control" %>
          </section>
        </section>
        <section class="col-md">
          <section class="form-group">
            <%= f.label :latest_start_date %>
            <%= f.date_field :latest_start_date, value: params[:latest_start_date], class: "form-control" %>
          </section>
        </section>
      </section>
      <hr>
      <%= submit_tag "Apply filters", class: "btn btn-secondary" %>
    <% end %>
  </section>
</section>

<table class="table table-hover">
  <tr>
    <th><%= sortable "name" %></th>
    <th><%= sortable "dates" %></th>
    <th><%= sortable "location", "Approximate location" %></th>
    <% if is_admin? %>
      <th>Edit</th>
      <th>Delete</th>
    <% end %>
  </tr>
  <% @tournaments.each do |tournament| %>
    <tr>
      <td><%= link_to tournament.name, tournament_path(tournament) %></td>
      <td><%= tournament.date_range %></td>
      <td><%= tournament.location %></td>
      <% if is_admin? %>
        <td><%= link_to "Edit", edit_tournament_path(tournament) %></td>
        <td><%= link_to 'Delete', tournament_path(tournament),
                method: :delete,
                data: { confirm: 'Are you sure?' } %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>
